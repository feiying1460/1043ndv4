(function(a){a.su.Widget("progressbar",{defaults:{text:"",fieldLabel:"",tips:"",_timeout:0,value:0,url:null,isProgressbar:true,showPercentage:true,width:18,height:6,fn:null,widgetName:"progressbar",type:"horizontal"},create:function(d,b){var c=this;c.each(function(n,m){var q=a(m);if(q.is("input")){var f=q.attr("name")||"",h=q.attr("id")||"",s=q.attr("class")||"";var g=a('<div id="'+h+'" name="'+f+'" class="'+s+'"></div>');q.replaceWith(g);a.su.clearAttrAll(q);g.append(q.addClass("hidden"));m=g.get(0);q=g;c=g}a.extend(m,d,b);var r=m.type,t=m.value,k=m.width,l=m.height,j=r==="horizontal"?"width:"+k*t+"px":"height:"+l*t+"px";q.addClass("container widget-container progressbar-container progressbar-"+r);var e="";if(m.fieldLabel!==null){e+='<div class="widget-fieldlabel-wrap '+m.labelCls+'">';e+='<label class="widget-fieldlabel processbar-fieldlabel">'+m.fieldLabel+"</label>";if(m.fieldLabel!==""){e+='<span class="widget-separator">'+m.separator+"</span>"}e+="</div>"}e+='<div class="progressbar-wrap">';e+='<div class="widget-wrap progressbar-content">';e+='<div class="progressbar-value" style="'+j+'"></div>';e+="</div>";e+='<div class="progressbar-text">';if(m.text!=""){e+='<span class="progressbar-text">'+m.text+"</span>"}if(m.showPercentage){e+='<span class="progressbar-percentage">'+t*100+"%</span>"}e+="</div>";e+="</div>";e+='<span class="widget-tips progressbar-tips">'+m.tips+"</span>";var p=a(e);q.append(p);var o=q.find("div.progressbar-content").css("width",m.width);a(o.get(0)).css("height",m.height)});return c},animate:function(k,b){var k=k||this,l=k.get(0).type,n=l==="horizontal"?"width":"height";var c=parseInt(b[1]*100,10),g=parseInt(b[2]*100,10),e=a.type(parseInt(b[3],10))==="number"?parseInt(b[3],10):500,o=b[4]||null,m=c||0;var d=k.find("div.progressbar-content"),f=d.children("div.progressbar-value"),i=k.find("span.progressbar-percentage");var h=d[n]();f.css(n,parseInt(h*c/100,10));i.html(c+"%");k.get(0)._timeout=setInterval(function(){if(m!=g){if(m>g){m--}else{m++}i.html(m+"%")}else{clearInterval(k.get(0)._timeout);k.get(0)._timeout=0;if(o){o.call(k)}}},parseInt(e/Math.abs(g-c)),10);var j=n==="width"?{width:parseInt(h*g/100,10)}:{height:parseInt(h*g/100,10)};f.animate(j,e,function(){i.html(g+"%")});k.get(0).value=parseInt(g/100,10)},setText:function(b,c){var b=b||this,e=c[0];var d=b.find("span.progressbar-text");d.html(e)},setValue:function(h,c){var h=h||this,i=h.get(0).type,l=i==="horizontal"?"width":"height";var k=c[1]||0,m=c[2]||h.get(0).text,b=c[3]||false;var d=h.find("div.progressbar-content"),e=d.children("div.progressbar-value"),g=h.find("span.progressbar-percentage"),j=h.find("span.progressbar-text");var f=d[l]();if(!b){e.css(l,f*k);g.html((k*100).toFixed(1)+"%");j.html(m)}else{h.progressbar("animate",h.get(0).value,k,500,function(){j.html(m)})}h.get(0).value=parseInt(k,10)},update:function(e,h){var e=e||this,d=e.get(0).type,g=d==="horizontal"?"width":"height",b=b||"percentage";var c=h[1]||e.get(0).url,f=h[2],i=h[3]||null;a.ajax({url:c,type:"POST",data:f,dataType:"json",tradidional:true,cache:false,success:i||function(k){var j=k[b];if(j){e.progressbar("setValue",j,null,true)}else{console.error("Can not find the percentage data!");return null}}})}})})(jQuery);